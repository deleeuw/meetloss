<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.21">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-05-05">

<title>2&nbsp; Coding and Transformations – Homogeneity Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./algorithm.html" rel="next">
<link href="./intro.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea1d7ac60288e0f1efdbc993fd8432ae.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-de6c7be80aad2e30aa3088f7100c4292.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./coding.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Coding and Transformations</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="./index.html" class="sidebar-logo-link">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Homogeneity Analysis</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./coding.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Coding and Transformations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./algorithm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Algorithm</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./mca.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Multiple Correspondence Analysis and homals()</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./ca.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Correspondence Analysis and corals()</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pca.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Nonlinear Principal Component Analysis and princals()</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./canals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Canonical Analysis and canals()</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#variables-and-multivariables" id="toc-variables-and-multivariables" class="nav-link active" data-scroll-target="#variables-and-multivariables"><span class="header-section-number">2.1</span> Variables and Multivariables</a></li>
  <li><a href="#induced-correlations-and-aspects" id="toc-induced-correlations-and-aspects" class="nav-link" data-scroll-target="#induced-correlations-and-aspects"><span class="header-section-number">2.2</span> Induced Correlations and Aspects</a></li>
  <li><a href="#transformed-variables" id="toc-transformed-variables" class="nav-link" data-scroll-target="#transformed-variables"><span class="header-section-number">2.3</span> Transformed Variables</a></li>
  <li><a href="#bases" id="toc-bases" class="nav-link" data-scroll-target="#bases"><span class="header-section-number">2.4</span> Bases</a></li>
  <li><a href="#copies-and-rank" id="toc-copies-and-rank" class="nav-link" data-scroll-target="#copies-and-rank"><span class="header-section-number">2.5</span> Copies and Rank</a></li>
  <li><a href="#orthoblocks" id="toc-orthoblocks" class="nav-link" data-scroll-target="#orthoblocks"><span class="header-section-number">2.6</span> Orthoblocks</a></li>
  <li><a href="#constraints" id="toc-constraints" class="nav-link" data-scroll-target="#constraints"><span class="header-section-number">2.7</span> Constraints</a></li>
  <li><a href="#missing-data" id="toc-missing-data" class="nav-link" data-scroll-target="#missing-data"><span class="header-section-number">2.8</span> Missing Data</a></li>
  <li><a href="#active-and-passive-variables" id="toc-active-and-passive-variables" class="nav-link" data-scroll-target="#active-and-passive-variables"><span class="header-section-number">2.9</span> Active and Passive Variables</a></li>
  <li><a href="#interactive-coding" id="toc-interactive-coding" class="nav-link" data-scroll-target="#interactive-coding"><span class="header-section-number">2.10</span> Interactive Coding</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Coding and Transformations</span></h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 5, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="variables-and-multivariables" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="variables-and-multivariables"><span class="header-section-number">2.1</span> Variables and Multivariables</h2>
<p>In the multivariate analysis techniques presented in this book the data are measurements or classifications of <span class="math inline">\(n\)</span> <em>objects</em> by <span class="math inline">\(m\)</span> <em>variables</em>. Perhaps it is useful to insert some definitions here. A <em>variable</em> is a function that maps a domain of objects to a range of values. Domains are finite. The elements of the domain can be individuals, animals, plants, time points, locations, and so on. It is useful to distinguish the <em>codomain</em> (or <em>range</em>) of a variable and its <em>image</em>. The codomain of a variable can be the real numbers, but the image always is a finite set, the actual values the variable assumes on the domain. A <em>multivariable</em> is a sequence of variables defined on the same domain, with possibly different codomains. Multivariables are implemented in R as <em>dataframes</em>. Variables can have a finite codomain, which can be either ordered or unordered. This corresponds with a <em>factor</em> or an <em>ordered factor</em> in R. MVAOS techniques <em>quantify</em> factors, replacing the values in the image by real numbers. If the variables are real-valued to start with we replace real numbers by other real numbers and we <em>transform</em> instead of <em>quantify</em>. The distinction between quantification and transformation is somewhat fluid, because the image of a variable is always finite and thus, in a sense, all variables are categorical (a point also emphasized, for example, in <span class="citation" data-cites="holland_79">Holland (<a href="#ref-holland_79" role="doc-biblioref">1979</a>)</span>).</p>
<p>Although the variables in a multivariable have the same domain, there can be different numbers of missing data for different variables. We handle this in the same way as R, by adding <code>NA</code> to the range of all variables. In this context it is also useful to define <em>latent</em> or <em>unobserved</em> variables. These are variables for which all values are missing, i.e.&nbsp;for which the image only contains <code>NA</code>. At first thought it seems somewhat perverse to have such completely missing variables, but think of examples such as principal components, factor scores, or error terms in linear models.</p>
</section>
<section id="induced-correlations-and-aspects" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="induced-correlations-and-aspects"><span class="header-section-number">2.2</span> Induced Correlations and Aspects</h2>
<p>If all categorical variables are quantified and all numerical variables are transformed we can compute the <em>induced correlation matrix</em> of the transformed and quantified variables. In the forms of MVAOS we consider in this book the statistics we compute, except for the transformations themselves, are usually functions of this induced correlation matrix. This means that they are functions of the second order relations between the variables, or, in order words, they are <em>joint bivariate</em>. Higher order moments and product moments are ignored. Different multivariate distributions with the same bivariate marginals will give the same MVAOS results.</p>
</section>
<section id="transformed-variables" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="transformed-variables"><span class="header-section-number">2.3</span> Transformed Variables</h2>
<p>The data are collected in the <span class="math inline">\(n\times m\)</span> matrix <span class="math inline">\(H\)</span>, which codes the observations on the <span class="math inline">\(m\)</span> variables. MVAOS does not operate on the data directly, but on <em>transformations</em> or <em>quantifications</em> of the variables. Choosing a transformation to minimize a loss function is known as <em>optimal scaling</em>. Clearly this so-called optimality is only defined in terms of a specific loss function, with specific constraints. Different constraints and different loss functions will lead to different optimal transformations.</p>
<p>Let us define the types of transformations we are interested in. The <span class="math inline">\(n\times m\)</span> matrix of <em>transformed variables</em> <span class="math inline">\(H\)</span> has columns <span class="math inline">\(h_j\)</span>, which are constrained by <span class="math inline">\(h_j=G_jz_j\)</span>, where <span class="math inline">\(G_j\)</span> is a given matrix defining the <em>basis</em> for variable <span class="math inline">\(j\)</span>. In addition we require <span class="math inline">\(h_j\in\mathcal{C}_j\)</span> and <span class="math inline">\(h_j\in\mathcal{S}\)</span>, where <span class="math inline">\(\mathcal{C}_j\)</span> is a <em>cone of transformations</em> and <span class="math inline">\(\mathcal{S}\)</span> is the unit sphere in <span class="math inline">\(\mathbb{R}^n\)</span>. This will be discussed in more detail in later sections, but for the time being think of the example in which <span class="math inline">\(h_j\)</span> is required to be a (centered and normalized) monotone polynomial function of the image values of variable <span class="math inline">\(j\)</span>. The whole of <span class="math inline">\(\mathbb{R}^n\)</span> and a single point in <span class="math inline">\(\mathbb{R}^n\)</span> are both special cases of these normalized cones. It is important, especially for algorithm construction, that the restrictions are defined for each variable separately. An exception to this rule is the <em>orthoblock</em>, using terminology from <span class="citation" data-cites="deleeuw_C_04a">De Leeuw (<a href="#ref-deleeuw_C_04a" role="doc-biblioref">2004</a>)</span>, which requires that all or some of the columns of <span class="math inline">\(H\)</span> are not only normalized but also orthogonal to each other. Clearly a normalized variable is an orthoblock of size one.</p>
</section>
<section id="bases" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="bases"><span class="header-section-number">2.4</span> Bases</h2>
<p>In earlier MVAOS work, summarized for example in <span class="citation" data-cites="gifi_B_90">Gifi (<a href="#ref-gifi_B_90" role="doc-biblioref">1990</a>)</span> or <span class="citation" data-cites="michailidis_deleeuw_A_98">Michailidis and De Leeuw (<a href="#ref-michailidis_deleeuw_A_98" role="doc-biblioref">1998</a>)</span>, the basis matrices <span class="math inline">\(G_j\)</span> were binary zero-one matrices, indicating category membership. These matrices are also known as <em>indicator matrices</em>. The same is true for the software in IBM SPSS Categories <span class="citation" data-cites="meulman_heiser_12">(<a href="#ref-meulman_heiser_12" role="doc-biblioref">Meulman and Heiser 2012</a>)</span> or in the R package homals <span class="citation" data-cites="deleeuw_mair_A_09a">(<a href="#ref-deleeuw_mair_A_09a" role="doc-biblioref">De Leeuw and Mair 2009</a>)</span>. In this paper we extend the current MVAOS software using <em>B-spline bases</em>, which provide a form of fuzzy non-binary coding suitable for both categorical and numerical variables <span class="citation" data-cites="vanrijckevorsel_deleeuw_B_88">(<a href="#ref-vanrijckevorsel_deleeuw_B_88" role="doc-biblioref">Van Rijckevorsel and De Leeuw 1988</a>)</span>. B-spline basis were already discussed for some special cases in <span class="citation" data-cites="deleeuw_vanrijckevorsel_vanderwouden_A_81">De Leeuw, Rijckevorsel, and Wouden (<a href="#ref-deleeuw_vanrijckevorsel_vanderwouden_A_81" role="doc-biblioref">1981</a>)</span> and <span class="citation" data-cites="gifi_B_90">Gifi (<a href="#ref-gifi_B_90" role="doc-biblioref">1990</a>)</span>, but corresponding easily accessible software was never released.</p>
<p>In this book we continue to use the term <em>indicators</em> for bases. Thus bases <span class="math inline">\(G_j\)</span> must be non-negative, with rows that add up to one. If there is only one non-zero entry in each row, which of course is then equal to one, the indicator is <em>crisp</em>, otherwise it is <em>fuzzy</em>. B-spline bases are the prime example of fuzzy indicators, but other examples are discussed in <span class="citation" data-cites="vanrijckevorsel_deleeuw_B_88">Van Rijckevorsel and De Leeuw (<a href="#ref-vanrijckevorsel_deleeuw_B_88" role="doc-biblioref">1988</a>)</span>. Only B-spline bases are implemented in our software, however.</p>
<p>Note that the identity matrix is a crisp indicator. This is of importance in connection with missing data and orthoblocks.</p>
</section>
<section id="copies-and-rank" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="copies-and-rank"><span class="header-section-number">2.5</span> Copies and Rank</h2>
<p>Within a block there can be more than one version of the same variable. These multiple versions are called <em>copies</em>. They were first introduced into the Gifi framework by <span class="citation" data-cites="deleeuw_C_84c">De Leeuw (<a href="#ref-deleeuw_C_84c" role="doc-biblioref">1984</a>)</span>. Since MVAOS transforms variables, having more than one copy is not necessarily redundant, because different copies can and will be transformed differently. As a simple example of copies, think of using different monomials or orthogonal polynomials of a single variable <span class="math inline">\(x\)</span> in a polynomial regression. The difference between copies and simply including a variable more than once is that copies have the same basis <span class="math inline">\(G_j\)</span>.</p>
<p>In the Gifi algorithms copies of a variable are treated in exactly the same way as other variables. The notion of copies replaces the notion of the <em>rank of a quantification</em> used in traditional Gifi, which in turn generalizes the distinction between <em>single</em> and <em>multiple</em> quantifications. A single variable has only one copy in its block, a multiple variable has the maximum number of copies.</p>
<p>In our software the copies of a variable by definition have the same basis. It is possible, of course, to include the same variable multiple times, but with different bases. This must be done, however, at the input level. In terms of the structures defined in the software, a gifiVariable can have multiple copies but it only has one basis. If there is more than one basis for a variable, then we need to define an additional gifiVariable. Also note that copies of a variable are all in the same block. If you want different versions of a variable in different blocks, then that requires you to create different gifiVariables.</p>
<p>Defining copies is thus basically a coding problem. It can be handled simply by adding a variable multiple times to a data set, and giving each variable the same bases. In our algorithm we use the fact that copies belong to the same variable to create some special shortcuts and handling routines.</p>
<p>Ordinality restrictions on variables with copies require some special attention. In our current implementation we merely require the first copy to be ordinal with the data, the other copies are not restricted. Once again, if you want ordinal restrictions on all copies you need to create separate gifiVariables for each copy.</p>
</section>
<section id="orthoblocks" class="level2" data-number="2.6">
<h2 data-number="2.6" class="anchored" data-anchor-id="orthoblocks"><span class="header-section-number">2.6</span> Orthoblocks</h2>
<p>If a variable has more than one copy, then we require without loss of generality that the transformations are orthogonal.</p>
</section>
<section id="constraints" class="level2" data-number="2.7">
<h2 data-number="2.7" class="anchored" data-anchor-id="constraints"><span class="header-section-number">2.7</span> Constraints</h2>
<p>As discussed earlier, each variable has a cone of transformations associated with it, and we optimize over these transformations. In ALSOS and classical Gifi the three type of transformation cones considered are <em>nominal, ordinal,</em> and <em>numerical</em>. Our use of B-splines generalizes this distinction, because both numerical and nominal can be implemented using splines. What remains is the choice for the degree of the spline and the location of the knots.</p>
<p>Choice of degree and knots is basically up to the user, but the programs have some defaults. In most cases the default is to use crisp indicators with knots at the data points. Of course for truly categorical variables (i.e.&nbsp;for factors in R) crisp indicators are simply constructed by using the levels of the factor. We include some utilities to place knots at percentiles, or equally spaced on the range, or to have no interior knots at all (in which case we fit polynomials).</p>
<p>And finally the user decides, for all variables, if she wants the transformations (step functions, splines, and polynomials) to be monotonic with the data. Default is not requiring monotonicity.</p>
<p>Note that we require the spline to be monotonic in the non-missing data points – this does not mean the spline is monotonic outside the range of the data (think, for example, of a quadratic polynomial), it does not even mean the spline is monotonic between data points. This makes our spline transformations different from the integrated B-splines, or I-splines, used by <span class="citation" data-cites="winsberg_ramsay_83">Winsberg and Ramsay (<a href="#ref-winsberg_ramsay_83" role="doc-biblioref">1983</a>)</span>, which are monotone on the whole real line. Because each variable has a finite image we are not really fitting a spline, we are fitting a number of discrete points that are required to be on a spline, and optionally to be monotonic with the data. In <span class="citation" data-cites="winsberg_ramsay_83">Winsberg and Ramsay (<a href="#ref-winsberg_ramsay_83" role="doc-biblioref">1983</a>)</span> the requirement is that the fitted points are on an I-spline, which automatically makes them monotonic with the data. Clearly our approach is the less restrictive one.</p>
</section>
<section id="missing-data" class="level2" data-number="2.8">
<h2 data-number="2.8" class="anchored" data-anchor-id="missing-data"><span class="header-section-number">2.8</span> Missing Data</h2>
<p>The utility <code>makeMissing()</code> expands the basis for the non-missing data in various ways. Option “m” (for “multiple”) is the default. It replaces the basis with the direct sum of the non-missing basis and an identity matrix for the missing elements. Option “s” (for “single”) adds a single binary column to the basis indicating which elements are missing. Option “a” (for “average”) codes missing data by having all the elements in rows of the basis corresponding with missing data equal to one over the number of rows. With all three options the basis remains an indicator. Some of these options make most sense in the context of crisp indicators, where they are compared in <span class="citation" data-cites="meulman_82">Meulman (<a href="#ref-meulman_82" role="doc-biblioref">1982</a>)</span>.</p>
<p>So suppose the data are</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] 
[1,] -0.50
[2,]    NA
[3,]  0.75
[4,]  0.99
[5,]    NA</code></pre>
</div>
</div>
<p>Create a basis for the non-missing values with</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mprint</span>(basis <span class="ot">&lt;-</span> <span class="fu">bsplineBasis</span>(x[<span class="fu">which</span>(<span class="sc">!</span><span class="fu">is.na</span>(x))],<span class="dv">1</span>,<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]  [,2]  [,3] 
[1,]  0.50  0.50  0.00
[2,]  0.00  0.25  0.75
[3,]  0.00  0.01  0.99</code></pre>
</div>
</div>
<p>The three different completion options for missing data give</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mprint</span> (<span class="fu">makeMissing</span> (x, basis, <span class="at">missing =</span> <span class="st">"m"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]  [,2]  [,3]  [,4]  [,5] 
[1,]  0.50  0.50  0.00  0.00  0.00
[2,]  0.00  0.00  0.00  1.00  0.00
[3,]  0.00  0.25  0.75  0.00  0.00
[4,]  0.00  0.01  0.99  0.00  0.00
[5,]  0.00  0.00  0.00  0.00  1.00</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mprint</span> (<span class="fu">makeMissing</span> (x, basis, <span class="at">missing =</span> <span class="st">"s"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]  [,2]  [,3]  [,4] 
[1,]  0.50  0.50  0.00  0.00
[2,]  0.00  0.00  0.00  1.00
[3,]  0.00  0.25  0.75  0.00
[4,]  0.00  0.01  0.99  0.00
[5,]  0.00  0.00  0.00  1.00</code></pre>
</div>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mprint</span> (<span class="fu">makeMissing</span> (x, basis, <span class="at">missing =</span> <span class="st">"a"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]  [,2]  [,3] 
[1,]  0.50  0.50  0.00
[2,]  0.33  0.33  0.33
[3,]  0.00  0.25  0.75
[4,]  0.00  0.01  0.99
[5,]  0.33  0.33  0.33</code></pre>
</div>
</div>
<p>The default option for missing data in the previous version of the Gifi system was “missing data deleted”, which involves weighting the rows in the loss functions by the number of non-missing data in that row. This leads to some complications, and consequently we have no option “d” in this version of Gifi.</p>
</section>
<section id="active-and-passive-variables" class="level2" data-number="2.9">
<h2 data-number="2.9" class="anchored" data-anchor-id="active-and-passive-variables"><span class="header-section-number">2.9</span> Active and Passive Variables</h2>
<p>If a variable is <em>passive</em> (or <em>supplementary</em>) it is incorporated in the analysis, but it does not contribute to the loss. Thus an analysis that leaves the passive variables out will give the same results for the active variables. Passive variables are transformed like all the others, but they do not contribute to the block scores, and thus not to the loss. They have category quantifications and scores, and can be used in the corresponding plots.</p>
<p>If all variables in a block are passive, then the whole block does not contribute to the loss. This happens specifically for singletons, if the single variable in the block is passive.</p>
</section>
<section id="interactive-coding" class="level2" data-number="2.10">
<h2 data-number="2.10" class="anchored" data-anchor-id="interactive-coding"><span class="header-section-number">2.10</span> Interactive Coding</h2>
<p>One of the major contributions of <em>Analyse des Données</em> is the emphasis on <em>coding</em>, which in our context can be defined as choosing how to represent the raw data of an experiment in an actual data frame (and, to a lesser extent, how to choose blocks, number of copies, dimensionality, degrees, and knots). In the section we discuss one important coding variation. Suppose we have <span class="math inline">\(n\)</span> observations on two factors, one with <span class="math inline">\(p\)</span> levels and one with <span class="math inline">\(q\)</span> levels. Then the data can be coded as <span class="math inline">\(n\)</span> observations on one factor with <span class="math inline">\(p\times q\)</span> levels, and we can construct a corresponding crisp indicator. The same reasoning applies to more than two categorical variables, which we can always code <em>interactively</em>. It also applies to bases for numerical variables, where we can define an interactive basis by using products of columns from the bases of each of the variables.</p>
<p>If <span class="math inline">\(G=\{g_{is}\}\)</span> and <span class="math inline">\(H=\{h_{it}\}\)</span> are two indicators of dimensions <span class="math inline">\(n\times m_g\)</span> and <span class="math inline">\(n\times m_h\)</span>, then the <span class="math inline">\(n\times m_gm_h\)</span> matrix with elements {g_{is}h_{it}} is again an indicator: the elements are non-negative, and rows add up to one.</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mprint</span> (x <span class="ot">&lt;-</span> <span class="fu">bsplineBasis</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span><span class="sc">/</span><span class="dv">10</span>, <span class="dv">1</span>, .<span class="dv">5</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1]  [,2]  [,3] 
 [1,]  1.00  0.00  0.00
 [2,]  0.75  0.25  0.00
 [3,]  0.50  0.50  0.00
 [4,]  0.25  0.75  0.00
 [5,]  0.00  1.00  0.00
 [6,]  0.00  0.75  0.25
 [7,]  0.00  0.50  0.50
 [8,]  0.00  0.25  0.75
 [9,]  0.00  0.00  1.00</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mprint</span> (y <span class="ot">&lt;-</span> <span class="fu">makeIndicator</span> (<span class="fu">c</span> (<span class="fu">rep</span> (<span class="dv">1</span>, <span class="dv">5</span>), <span class="fu">rep</span> (<span class="dv">2</span>, <span class="dv">4</span>))))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1]  [,2] 
 [1,]  1.00  0.00
 [2,]  1.00  0.00
 [3,]  1.00  0.00
 [4,]  1.00  0.00
 [5,]  1.00  0.00
 [6,]  0.00  1.00
 [7,]  0.00  1.00
 [8,]  0.00  1.00
 [9,]  0.00  1.00</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mprint</span> (<span class="fu">makeColumnProduct</span> (<span class="fu">list</span> (x, y)))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1]  [,2]  [,3]  [,4]  [,5]  [,6] 
 [1,]  1.00  0.00  0.00  0.00  0.00  0.00
 [2,]  0.75  0.00  0.25  0.00  0.00  0.00
 [3,]  0.50  0.00  0.50  0.00  0.00  0.00
 [4,]  0.25  0.00  0.75  0.00  0.00  0.00
 [5,]  0.00  0.00  1.00  0.00  0.00  0.00
 [6,]  0.00  0.00  0.00  0.75  0.00  0.25
 [7,]  0.00  0.00  0.00  0.50  0.00  0.50
 [8,]  0.00  0.00  0.00  0.25  0.00  0.75
 [9,]  0.00  0.00  0.00  0.00  0.00  1.00</code></pre>
</div>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-deleeuw_C_84c" class="csl-entry" role="listitem">
De Leeuw, J. 1984. <span>“The Gifi System of Nonlinear Multivariate Analysis.”</span> In <em>Data Analysis and Informatics</em>, edited by E. Diday et al. Vol. III. Amsterdam: North Holland Publishing Company.
</div>
<div id="ref-deleeuw_C_04a" class="csl-entry" role="listitem">
———. 2004. <span>“Least Squares Optimal Scaling of Partially Observed Linear Systems.”</span> In <em>Recent Developments in Structural Equation Models</em>, edited by K. van Montfort, J. Oud, and A. Satorra. Dordrecht, Netherlands: Kluwer Academic Publishers.
</div>
<div id="ref-deleeuw_mair_A_09a" class="csl-entry" role="listitem">
De Leeuw, J., and P. Mair. 2009. <span>“<span class="nocase">Homogeneity Analysis in <span>R</span>: the Package homals</span>.”</span> <em>Journal of Statistical Software</em> 31 (4): 1–21. <a href="https://www.jstatsoft.org/v31/i04/">https://www.jstatsoft.org/v31/i04/</a>.
</div>
<div id="ref-deleeuw_vanrijckevorsel_vanderwouden_A_81" class="csl-entry" role="listitem">
De Leeuw, J., J. L. A. Van Rijckevorsel, and H. Van der Wouden. 1981. <span>“Nonlinear Principal Component Analysis Using b-Splines.”</span> <em>Methods of Operations Research</em> 43: 379–94.
</div>
<div id="ref-gifi_B_90" class="csl-entry" role="listitem">
Gifi, A. 1990. <em>Nonlinear Multivariate Analysis</em>. New York, N.Y.: Wiley.
</div>
<div id="ref-holland_79" class="csl-entry" role="listitem">
Holland, P. W. 1979. <span>“<span class="nocase">The Tyranny of Continuous Models in a World of Discrete Data</span>.”</span> <em>IHS-Journal</em> 3: 29–42.
</div>
<div id="ref-meulman_82" class="csl-entry" role="listitem">
Meulman, J. J. 1982. <em><span class="nocase">Homogeneity Analysis of Incomplete Data</span></em>. Leiden, The Netherlands: <span>DSWO</span> Press.
</div>
<div id="ref-meulman_heiser_12" class="csl-entry" role="listitem">
Meulman, J. J., and W. J. Heiser. 2012. <em>IBM SPSS Categories 21</em>. IBM Corporation.
</div>
<div id="ref-michailidis_deleeuw_A_98" class="csl-entry" role="listitem">
Michailidis, G., and J. De Leeuw. 1998. <span>“The Gifi System for Descriptive Multivariate Analysis.”</span> <em>Statistical Science</em> 13: 307–36.
</div>
<div id="ref-vanrijckevorsel_deleeuw_B_88" class="csl-entry" role="listitem">
Van Rijckevorsel, J. L. A., and J. De Leeuw, eds. 1988. <em>Component and Correspondence Analysis</em>. Wiley.
</div>
<div id="ref-winsberg_ramsay_83" class="csl-entry" role="listitem">
Winsberg, S., and J. O. Ramsay. 1983. <span>“<span class="nocase">Monotone Spline Transformations for Dimension Reduction</span>.”</span> <em>Psychometrika</em> 48: 575–95.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./intro.html" class="pagination-link" aria-label="Introduction">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./algorithm.html" class="pagination-link" aria-label="Algorithm">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Algorithm</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>