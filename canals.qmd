```{r ca, echo = FALSE}
source("code/gifiStructures.R")
source("code/gifiEngine.R")
source("code/gifiUtilities.R")
source("code/canals.R")
source("code/matrix.R")
source("code/coneRegression.R")
source("code/splineBasis.R")
```

# Canonical Analysis and canals()

## Equations

Meet-loss
$$
\sigma(X,A,B)=\text{SSQ}(X-GA)+\text{SSQ}(X-HB)
$$
Minimize over $A$ and $B$ and $X'X=I$. 
$$
\min_{A,B}\sigma(X,A,B)=2p-\text{tr}\ X'(P_G+P_H)X
$$
with $P_G:=G(G'G)^{-1}G'$ and $P_H:=H(H'H)^{-1}H'$.

$$
(P_G+P_H)X=X\Lambda
$$

Minimize over $X$ and $A,B$ satisfying $A'G'GA+B'H'HB=I$.
$$
\min_X\sigma(X,A,B)=\frac12\text{SSQ}(GA-HB)=2p-\text{tr}\ A'G'HB
$$
$$
G'HB=G'GA\Lambda
H'GA=H'HB\Lambda
$$
If there are only two blocks the generalized eigenvalue problem for the Burt matrix becomes
$$
\begin{bmatrix}
D_1&C_{12}\\C_{21}&D_2
\end{bmatrix}
\begin{bmatrix}
a_1\\a_2
\end{bmatrix}=2\lambda\begin{bmatrix}D_1&0\\0&D_2\end{bmatrix}\begin{bmatrix}
a_1\\a_2
\end{bmatrix},
$$
which we can rewrite as
$$
\begin{split}
C_{12}a_2&=(2\lambda-1)D_1a_1,\\
C_{21}a_1&=(2\lambda-1)D_2a_2,
\end{split}
$$
from which we see that MVAOS maximizes the sum of the $r$ largest canonical correlations between $H_1$ and $H_2$. See also @vandervelden_12.

## Examples
